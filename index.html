<!DOCTYPE html> 
<html lang="en-EN"> 
  <head> 
    <meta charset="UTF-8"> 
    <title>Meryl, Minimalist web framework for NodeJS</title> 
    <script src="js/jquery-1.4.3.min.js" type="text/javascript" charset="utf-8"></script> 
    <link rel="stylesheet" href="css/common.css" type="text/css" /> 
  </head>
  <body>
    <div id="wrap">
      <div id="header">
        <h1><span>Meryl</span></h1>
        <h2><span>Simple to use, fun to play and easy to modify!</span></h2>
      </div>
      <div id="nav">
        <ul>
          <li><a href="#about">About</a></li>
          <li><a href="#install">Install</a></li>
          <li><a href="#documentation">Documentation</a></li>
          <li><a href="#tips">Tips</a></li>
          <li><a href="#source">Source</a></li>
        </ul>
      </div>
      <!-- <div id="fork-me"><a href="http://github.com/coffeemate/meryl"><img src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a></div> -->
      <!-- <div id="follow-me"><a href="http://www.twitter.com/meryljs"><img src="http://twitter-badges.s3.amazonaws.com/follow_me-a.png" alt="Follow meryljs on Twitter"/></a></div> -->
      <div id="about" class="article">
        <h3>About</h3>
        <p>
              Meryl is a minimalist web framework for <a href="http://nodejs.org">nodejs</a> platform which is very simple to use, fun to play and easy to modify.
        </p>
        <p>Meryl remains as thin web layer over nodejs's built-in http module which mainly consists of
					plugins and handlers processed through every http request and response pipe.</p>
        <p>Despite the small size of its code base, it has plenty of promising features.
          Some of the feature highlights are:</p>
        <ul>
          <li>Flexible architecture</li>
          <li>Url routing with an easy expression syntax.</li>
          <li>Powerful middleware infrastructure. Also compatible with <a href="http://github.com/senchalabs/connect" title="Connect framework">Connect framework</a>. </li>
          <li>Modular template rendering mechanism. You can choose using your mother's template engine.</li>
          <li>Dynamic template serving.</li>
          <li>Command line util for ad-hoc setup.</li>
        </ul>
				<p><img src="images/infog.png" width="516" height="337" alt="Info Graphic" /></p>  
      </div>
      <div id="install" class="article">
        <h3>Install</h3>
        <p>Use <a href="http://github.com/isaacs/npm" title="npm">npm</a> for painless, quicky experience.</p>
        <pre>$ npm install meryl</pre>
        <p>If you don't have npm, you can simply put meryl in your '$HOME/.node_libraries' directory.</p> 
        <pre class="js">$ cd $HOME/.node_libraries
$ git clone http://github.com/coffeemate/meryl.git</pre> 
        <p>Yep, it's ready already. Now you can use it in your applications by loading as usual in nodejs.</p>
        <pre class="js">var meryl = require('meryl');</pre>
      </div>
      <div id="quick-start" class="article">
        <h3>Quick start</h3>
        <p>
          If you installed Meryl sucessfully, now you are ready to get your feet wet.
          Create a file named 'app.js' with the copy of contents below.
        </p>
        <pre class="js">// app.js

var meryl = require('meryl');

meryl.h('GET /{yourname}?', function (req, resp) {
    resp.send('Hello, ' + req.params.yourname || 'World');
  }
);

meryl.run();</pre>
                    <p>Ok, let's run it.
                    </p>
                    <pre>$ node app.js</pre>
                    <p>
                      Now, go hit your http client with the url <code>http://localhost:3000</code>,
                      also try <code>http://localhost:3000/meryl</code>
                      and guess what you will see.
                    </p>
      </div>
      <div id="documentation" class="article">
        <h3>Documentation</h3>
        <div>
          <h4>Meryl request</h4>
          <p>
            Meryl extended http request object passed as a parameter to
            <a href="#meryl.h">meryl.h</a> and <a href="#meryl.h">meryl.p</a> callback functions which gives you some utilities
            to handle http request data coming from the client.
          </p>
          <blockquote>
          <h5>req.params</h5>
          <p>Object containing query string and path parameters with url info</p>
          <pre class="js">meryl.h('GET /list/{item}', function(req, resp) {
  // try: GET /list/comments?pagesize=10
  resp.send('Listing ' + req.params.pagesize + ' '
    + req.params.item);
});</pre>
          <h5>req.postdata</h5>
          <p>Buffer object received from the clients. It's a raw data which must be processed to refine if required</p>
          <pre class="js">meryl.h('POST /preview', function(req, resp) {
  // echo post data as text
  resp.headers['Content-Type'] = 'text/plain';
  resp.send(req.postdata);
});</pre>
</blockquote>
        </div>
        <div>
          <h4>Meryl response</h4>
          
          <p>
            Meryl extended http response object passed as a parameter to
            <a href="#meryl.h">meryl.h</a> and <a href="#meryl.h">meryl.p</a> callback functions which
            gives you some utilities to shape http response data delivering to the client.
          </p>
          <blockquote>
          <h5>resp.send(buffer)</h5>
          <p>Flushes response status and headers to the client side with the given contents of buffer parameter.</p>
          <pre class="js">meryl.h('GET /', function(req, resp) {
  resp.send('Hello Meryl');
});</pre>
          <h5>resp.render(templateName, data)</h5>
          <p>Renders a template name by manipulating it with given context data.</p>
          <pre class="js">meryl.h('GET /', function(req, resp) {
  resp.render('homepage', {foo: 'bar'});
});</pre>
          <h5>resp.headers</h5>
          <p>Object containing response headers.</p>
          <pre class="js">meryl.h('GET /foo.pdf', function(req, resp) {
  resp.headers['Content-Type'] = 'application/pdf';
  // omitted for brevity
  resp.send(pdfData);
});</pre>
          <h5>resp.status</h5>
          <p>Http status code of client response.</p>
          <pre class="js">meryl.h('GET /blank', function(req, resp) {
  resp.status = 204; // No Content
  resp.send();
});</pre>
</blockquote>
        </div>

        <div>
          <h4>Meryl context</h4>
          
          <p>Main execution context for all meryl's handler and plugin callbacks.
            It is the value of 'this' keyword inside <a href="#meryl.h">meryl.h</a> and <a href="#meryl.h">meryl.p</a> callback functions</p>
          <blockquote>
          <h5>this.options</h5>
          <p>Options object which is passed to the <a href="#meryl.cgi">meryl.cgi</a> function.</p>
          <pre class="js">meryl.h('GET /', function(req, resp) {
  if(this.options.debug)
    console.log('some log');
    
  // omitted for brevity
});
require('http').createServer(meryl.cgi({debug:true})).listen(3000);</pre>
        </blockquote>
        </div>

        <div>
          <h4 id="meryl.h">meryl.h[andle](expr, callback)</h4>
          <p>
            Registers a new http handler to global Meryl instance.
            First argument is the routing pattern which combines http verb
            with path expression while the second one is the callback
            function which will be executed in meryl context.
            If router pattern matches any http request the given callback
            executed with current req, resp objects.</p>
            <p>If more than one handlers registered with same router pattern
            only the first registered one will be executed.
          </p>
          <p>Routing pattern is very simple in mind:</p>
          <pre><code>$HTTP_VERB $PATH_EXPRESSION</code></pre>
          <p>The whole expression builds a meryl flavored reqular expression which exposes two types of path parameters.</p>
          <ul>
            <li><code>{ ... }</code> – curly braced parameters are partial, they match until the meet <code>'?'</code>, <code>'/'</code> or <code>'.'</code> character</li>
            <li><code>< ... ></code> – tagged(!) parameters are greedy, they match whatever they meet until you denote a block character.</li>
          </ul>
          <p>Here are some examples:</p>
          <ul>
            <li><code>{method} &lt;whatever&gt;</code>
              <ul>
                <li><code>GET /</code></li>
                <li><code>POST /index.html</code></li>
                <li><code>PUT /long/path/index.html</code></li>
                <li><code>DELETE /delete/something?foo=bar</code></li>
              </ul>
            </li>
            <li><code>GET /posts/{postid}</code>
              <ul>
                <li><code>GET /posts/this-is-a-long-post-id</code></li>
                <li><code>GET /posts/32432</code></li>
              </ul>
            </li>
            <li><code>GET /files/&lt;filepath&gt;.{ext}</code>
              <ul>
                <li><code>GET /files/filename.pdf</code></li>
                <li><code>GET /files/this/is/a/long/file/path.pdf</code></li>
              </ul>
            </li>
            <li><code>GET /(index.html)?</code>
              <ul>
                <li><code>GET /</code></li>
                <li><code>GET /index.html</code></li>
              </ul>
            </li>
          </ul>
          <p>Let's take look at a concrete example like below: </p>
          <pre class="js">meryl.h('GET /repo/< filepath>/{version}', function(req, resp) {
  var fileContents = readRepo(req.params.filepath, req.params.version);
  resp.send(fileContents);
});</pre>
        <p>Also there are shorthand helper functions mapped to individual http methods. You can declare
          handlers implicitly by using <code>meryl.get(expr, callback)</code>,
          <code>meryl.post(expr, callback)</code>, <code>meryl.put(expr, callback)</code>, 
          <code>meryl.put(expr, callback)</code> functions. You must omit explicit http method
          names in expressions</p>
          <pre class="js">meryl.get('/posts/{postid}', function(req, resp) {
  resp.send('reading post: ' + req.params.postid);
});

meryl.put('/', function(req, resp) {
  throw 'not supported';
});

</pre>
        </div>



        <div>
          <h4>meryl.p[lug]([expr] callback [, callback])</h4>
          <p>This function registers a plugin to the global meryl instance.
            More than one plugin can be executed on the same matched http request within the registration order.
            Plugin system simply exposes a middleware implementation for Meryl. </p><p>
            First argument is a router pattern which is also mentioned in meryl.h before.</p><p>
            The second one is the callback function which takes usual req, resp objects and alsa a function reference argument named 'next'.
            If you finished your work inside the plugin, you simply call 'next' to jump over to the next registered plugin.</p><p>
            You may want to break plugin iteration, then do not call 'next' method but be sure to end the http response in some way.
            Otherwise all the request/response pipe will hang which makes no sense for client side.</p>
          <p>
            Here is a sample application demonstrating plugins.
          </p>
          <pre class="js">// app.js

var meryl = require('meryl');

function validate(u, p) { return false; }

meryl.p('*', function(req, resp, next) {
  resp.headers.Server = 'meryl-nodejs';
  next();
});

meryl.p('{method} /private/*', function(req, resp, next) {
  if(validate(req.params.uname, req.params.passwd)) {
    next();
  } else {
    resp.status = 401;
    throw 'access denied';
  }
});

meryl.p('GET *', function(req, resp, next) {
  console.log('logging all GET requests');
  next();
});

meryl.h('GET /(index.html)?', function (req, resp) {
  resp.send('Demonstrating plugins');
});

require('http').createServer(meryl.cgi()).listen(3000);</pre>
<p>If you pass only callback function as first parameter by omitting expression Meryl assumes expression
  as '*' to match all requests.</p>
  <pre class="js">meryl.p(function(req, resp, next) {
    resp.headers.Server = 'meryl-nodejs';
    next();
});
  </pre>
  <p>Also you should mind appending more callbacks. It is very useful when registering pre-defined modules.</p>
    <pre class="js">var connect = require('connect');
meryl.p(connect.staticProvider(), connect.logger());
meryl.run();
    </pre>
        </div>
        <div>
          <h4>meryl.fabby([opts] | ([expr] [,callback [, callback]]))</h4>
          <p>This is a funny function which features <a href="http://github.com/jed/fab">fabjs</a>
            like chaining of Meryl plugins and handlers. 
            </p>
            <pre class="js">var connect = require('connect');
var meryl = require('meryl');

meryl.fabby
  (connect.logger(), connect.staticProvider())
  ('GET /', function (req, resp) {
      resp.render('home');
    }
  )
  ('GET /posts/{postid}', function (req, resp) {
      resp.render('post');
    }
  ) 
  ('GET /posts/{postid}/comments/{commentid}', function (req, resp) {
      resp.render('comment');
    }
  )  
  ();
</pre>
        </div>

        <div>
          <h4>meryl.handleNotFound(cb)</h4>
          <p>Custom 404 file not found handler</p>
        </div>
        <div>
          <h4>meryl.handleError(cb)</h4>
          <p>Custom 500 server error handler</p>
        </div>
        <div>
          <h4>meryl.cgi(opts)</h4>
          <p>It's the main entry point for Meryl. It returns a function reference
            for using with nodejs's built-in http module while creating a server instance.
            You can pass an object for further using in Meryl context such 'this.options'.</p>
          <pre class="js">require('http').createServer(meryl.cgi({debug:true})).listen(3000);</pre>
        </div>
        <div>
          <h4>meryl.run(opts)</h4>
          <p>Helper function that runs Meryl instantly by wrapping it with an internally created http server.
            It returns running http server instance.</p>
          <pre class="js">meryl.run({debug:true, port: 8080}))</pre>
        </div>

      </div>
                <div id="tips"  class="article">
                  <h3>Tips</h3>
                  <ul>
                    <li>
                    You can chain plugin and handler declerations as well.
                    </li>
                    <li>
                    You may choose using verbose function names instead single letter ones.
                    </li>
                    <li>
                    If you want to register a plugin for processing all requests
                    you can simply pass only your callback to the <a href="#meryl.p">meryl.p
                    </a> function.
                    </li>
                    <li>
                    You can mark path expression variables as optional using a trailing
                    question mark.
                    </li>
                    <li>
                    Meryl is <a href="http://github.com/senchalabs/connect" title="Connect framework">Connect</a> framework compatible. You can plug any Connect middleware module to Meryl.
                    </li>
                  </ul>
                  <p>Below the example demonstrates all the tips above.</p>
                  <pre class="js">require('http').createServer(
      require('meryl')

        .plug(require('connect').staticProvider())

        .plug(
          function(req, resp, next) { log(req.params.pathname); next() })

        .plug('POST *',
          function(req, resp, next) { throw 'restricted'; })

        .handle('GET /',
          function(req, resp) { resp.send('homepage') })

        .handle('GET /greet/({who}.html)?',
          function(req, resp) { resp.send('Hello, '
                  + req.params.who || 'World'); } )

        .cgi()
      ).listen(3000);</pre>
                </div>
                <div id="source" class="article">
                  <h3>Source</h3>
                  <p>Meryl uses lovely git and github. You can find sources <a href="http://github.com/coffeemate/meryl">here</a>.
                  To obtain a copy, simply type:</p>
                  <pre>git clone http://github.com/coffeemate/meryl.git</pre>
                  <p>Meryl itself is licensed under MIT License <a href="http://github.com/coffeemate/meryl/blob/master/license">http://github.com/coffeemate/meryl/blob/master/license</a></p>
                  <p>There are some kind people contributes to this project. Please join and help us to move
                    Meryl ahead together.</p>
                  <ul>
                    <li><a href="http://blog.kadirpekel.com">Kadir Pekel</a> (Author) <a href="http://www.twitter.com/kadirpekel"><img src="http://twitter-badges.s3.amazonaws.com/t_small-a.png" alt="Follow kadirpekel on Twitter"></a></li>
                    <li><a href="http://stagas.com">George Stagas</a> <a href="http://www.twitter.com/stagas"><img src="http://twitter-badges.s3.amazonaws.com/t_small-a.png" alt="Follow stagas on Twitter"></a></li>
                    <li><a href="http://www.ouvanous.com">Samuel Morello</a> <a href="http://www.twitter.com/ouvanous"><img src="http://twitter-badges.s3.amazonaws.com/t_small-a.png" alt="Follow ouvanous on Twitter"></a></li>
                    <li><a href="javascript:void(0)">Tom R</a> <a href="http://www.twitter.com/rx"><img src="http://twitter-badges.s3.amazonaws.com/t_small-a.png" alt="Follow rx on Twitter"></a></li>
                  </ul>
                </div>
      
      <div id="footer">
        <hr />
        
      </div>
    </div>
    <script type="text/javascript">window.hijs = '.js';</script> 
    <script src="js/hijs.js" type="text/javascript" charset="utf-8"></script>
  </body> 
</html>